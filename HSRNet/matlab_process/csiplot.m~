rxdir=['../rxdata/4.30/4.30.0/'];
unwrap_able = 1;

trial_check_list = [];
trial_port_list = [];
trial_csi_list = [];
for i=1:80
    csifile = [rxdir 'epoch' int2str(i-1) '/csi.mat'];
    disp(csifile);
    load(csifile);
    %'h_all_est','checklist','cfo_list','ber_list','snr_list','bf_snr_list','max_snr_list'
    
    % port check 
    trial_check_list(i,:) = sum(checklist);
    trial_port_list(i,:) = sum(checklist)+5>max(sum(checklist));
    port_able = find(trial_port_list(i,:)>0);
    
    % csi: h_all_est
    trial_csi_list(port_)
end

return;


% csi insert
h_all_est(:,1:60:end) = h_all_est(:,2:60:end).^2./h_all_est(:,3:60:end);
h_all_angle = angle(h_all_est);
h_shape=size(h_all_est);


if unwrap_able
    disp('unwrap_able');
    angle_unwrap=unwrap(h_all_angle,[],1);
    angle_unwrap=unwrap(angle_unwrap,[],2);
    angle_unwrap=unwrap(angle_unwrap,[],1); 
else
    disp('unwrap_disable');
    angle_unwrap=h_all_angle;
end

for i=1:h_shape(3)
    figure; mesh(angle_unwrap(:,:,i)); title(['angle of port' int2str(i)]);
end


figure;
for i=1:h_shape(3)
    if i==ref_port continue; end
     mesh(angle_unwrap(:,:,i)-angle_unwrap(:,:,ref_port));  hold on; figure;
end